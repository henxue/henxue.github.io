<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=11,IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-title" content="恨雪博客">
<title>帝国CMS后台整合kindeditor编辑器_恨雪博客 - 专注帝国CMS网站建设及模版制作 | www.henxue.net</title>
<link rel='stylesheet' id='main-css'  href='/skin/xiu/css/style.css' type='text/css' media='all' />
<link rel='canonical' href='帝国CMS后台整合kindeditor编辑器' />
<meta name="keywords" content="" />
<meta name="description" content="帝国CMS后台整合kindeditor编辑器" />
<!--[if lt IE 9]><script src="/skin/xiu/js/html5.js"></script><![endif]-->
</head>
<body>
<section class="container">
  <header class="header">
    <div class="logo"><a href="/" title="恨雪博客 - 专注帝国CMS网站建设及模版制作 | www.henxue.net">恨雪博客</a></div>
    <ul class="nav">
<li><a href="/" target="_self">首页</a></li>
<li><a class='current'  href="/tutorials/" target="_blank">帝国教程</a></li>
<li><a   href="/template/" target="_blank">帝国模版</a></li>
<li><a   href="/plug/" target="_blank">插件模块</a></li>
<li><a   href="/news/" target="_blank">业界新闻</a></li>
<li><a   href="/website/" target="_blank">建站相关</a></li>
<li><a   href="/design/" target="_blank">前端设计</a></li>
<li><a   href="/lnmpa/" target="_blank">LNMPA</a></li>
<li><a   href="/seo/" target="_blank">SEO</a></li>
<li><a   href="/blog/" target="_blank">网络日志</a></li>
    
    </ul>
    <div class="feeds"> <a class="feed feed-rss" rel="external nofollow" href="http://feed.feedsky.com/hengxue" title="Feed订阅恨雪博客" target="_blank">订阅</a> <a class="feed feed-weibo" rel="external nofollow" href="http://weibo.com/hongrongshun" title="关注博主新浪微博" target="_blank">新浪微博</a> <a class="feed feed-tqq" rel="external nofollow" href="http://t.qq.com/rosonho" title="关注博主腾讯微博" target="_blank">腾讯微博</a> <a class="feed feed-weixin" rel="external nofollow" href="javascript:;">关注微信</a> </div>
    <div class="slinks">QQ:415245871</div>
  </header>
  <div class="content-wrap">
    <div class="content">
      <header class="article-header">
        <h1 class="article-title"><a href="/article/99.html">帝国CMS后台整合kindeditor编辑器</a></h1>
        <ul class="article-meta">
          <li>henxue 发布于 4小时前</li>
          <li>分类：<a href="/tutorials/" title="查看帝国教程中的全部文章" rel="category tag">帝国教程</a></li>
          <li class="post-views">阅读(<script src=/e/public/ViewClick/?classid=1&id=99&addclick=1></script>)</li>
          <li><a href="#pinglun" title="去发表你的看法">评论</a></li>
          <li></li>
        </ul>
      </header>
      <article class="article-content">			<p>帝国模板的FCK编辑器实在是太操蛋了，特别是不能批量上传图片。虽然有人整合了一些插件，但往往不如人愿，所以有些人要么换成百度编辑器，要么换成kindeditor编辑器。今天恨雪为大家介绍的就是如何整合kindeditor编辑器，这里用的是最新版4.1.10。</p><p>首先到官方网站下载一下kindeditor：<a href="http://kindeditor.net/down.php">http://kindeditor.net/down.php</a></p><p>下载下来以后，可以先删掉一些没用的东西：</p><p><img alt="20131220204103.png" src="/d/file/2014/06/17/d7c7bdba7d620d8539de76e529cccea6.png" width="230" height="311" /></p><p>然后上传kindeditor-4.1.10文件夹到网站，至于上传到哪里，看个人喜好。我这边演示的是上传到根目录，不管上传到哪里，下面调用文件的时候记得路径对就好。</p><p>接下来，到网站后台修改一下newstext字段（系统&gt;数据表&gt;你要改的那个系统模型&gt;字段管理&gt;newstext&gt;输入表单替换html代码）改成下面的（注意文件调用的路径）</p><blockquote><p>&lt;link rel=&#8221;stylesheet&#8221; href=&#8221;/kindeditor/themes/default/default.css&#8221; /&gt;<br />&lt;link rel=&#8221;stylesheet&#8221; href=&#8221;/kindeditor/plugins/code/prettify.css&#8221; /&gt;<br />&lt;script charset=&#8221;utf-8&#8243; src=&#8221;/kindeditor/kindeditor.js&#8221;&gt;&lt;/script&gt;<br />&lt;script charset=&#8221;utf-8&#8243; src=&#8221;/kindeditor/lang/zh_CN.js&#8221;&gt;&lt;/script&gt;<br />&lt;script charset=&#8221;utf-8&#8243; src=&#8221;/kindeditor/plugins/code/prettify.js&#8221;&gt;&lt;/script&gt;<br />&lt;script&gt;<br />KindEditor.ready(function(K) {<br />var editor1 = K.create(&#8216;textarea[name="newstext"]&#8216;, {<br />cssPath : &#8216;/kindeditor/plugins/code/prettify.css&#8217;,<br />uploadJson : &#8216;/kindeditor/php/upload_json.php&#8217;,<br />fileManagerJson : &#8216;/kindeditor/php/file_manager_json.php&#8217;,<br />allowFileManager : true,<br />afterCreate : function() {<br />var self = this;<br />K.ctrl(document, 13, function() {<br />self.sync();<br />K(&#8216;form[name=example]&#8216;)[0].submit();<br />});<br />K.ctrl(self.edit.doc, 13, function() {<br />self.sync();<br />K(&#8216;form[name=example]&#8216;)[0].submit();<br />});<br />}<br />});<br />prettyPrint();<br />});<br />&lt;/script&gt;<br />&lt;textarea name=&#8221;newstext&#8221; style=&#8221;width:100%;height:300px;visibility:hidden;&#8221;&gt;&lt;?=$ecmsfirstpost==1?&#8221;":stripSlashes($r[newstext])?&gt; &lt;/textarea&gt;<br />&lt;table width=&#8221;100%&#8221; border=&#8221;0&#8243; cellpadding=&#8221;3&#8243; cellspacing=&#8221;1&#8243; bgcolor=&#8221;#DBEAF5&#8243;&gt;<br />&lt;tr&gt;<br />&lt;td bgcolor=&#8221;#FFFFFF&#8221;&gt; &lt;input name=&#8221;dokey&#8221; type=&#8221;checkbox&#8221; value=&#8221;1&#8243;&lt;?=$r[dokey]==1?&#8217; checked&#8217;:&#8221;?&gt;&gt;<br />关键字替换&amp;nbsp;&amp;nbsp; &lt;input name=&#8221;copyimg&#8221; type=&#8221;checkbox&#8221; id=&#8221;copyimg&#8221; value=&#8221;1&#8243; checked&gt;<br />远程保存图片(<br />&lt;input name=&#8221;mark&#8221; type=&#8221;checkbox&#8221; id=&#8221;mark&#8221; value=&#8221;1&#8243; checked&gt;<br />&lt;a href=&#8221;SetEnews.php&#8221; target=&#8221;_blank&#8221;&gt;加水印&lt;/a&gt;)&amp;nbsp;&amp;nbsp;<br />&lt;input name=&#8221;copyflash&#8221; type=&#8221;checkbox&#8221; id=&#8221;copyflash&#8221; value=&#8221;1&#8243;&gt;<br />远程保存FLASH(地址前缀：<br />&lt;input name=&#8221;qz_url&#8221; type=&#8221;text&#8221; id=&#8221;qz_url&#8221; size=&#8221;"&gt;<br />)&lt;/td&gt;<br />&lt;/tr&gt;<br />&lt;tr&gt;</p><p>&lt;td bgcolor=&#8221;#FFFFFF&#8221;&gt;&lt;input name=&#8221;repimgnexturl&#8221; type=&#8221;checkbox&#8221; id=&#8221;repimgnexturl&#8221; value=&#8221;1&#8243;&gt; 图片链接转为下一页&amp;nbsp;&amp;nbsp; &lt;input name=&#8221;autopage&#8221; type=&#8221;checkbox&#8221; id=&#8221;autopage&#8221; value=&#8221;1&#8243;&gt; 自动分页<br />,每<br />&lt;input name=&#8221;autosize&#8221; type=&#8221;text&#8221; id=&#8221;autosize&#8221; value=&#8221;5000&#8243; size=&#8221;5&#8243;&gt;<br />个字节为一页&amp;nbsp;&amp;nbsp; 取第<br />&lt;input name=&#8221;getfirsttitlepic&#8221; type=&#8221;text&#8221; id=&#8221;getfirsttitlepic&#8221; value=&#8221;1&#8243; size=&#8221;1&#8243;&gt;<br />张上传图为标题图片(<br />&lt;input name=&#8221;getfirsttitlespic&#8221; type=&#8221;checkbox&#8221; id=&#8221;getfirsttitlespic&#8221; value=&#8221;1&#8243;&gt;<br />缩略图: 宽<br />&lt;input name=&#8221;getfirsttitlespicw&#8221; type=&#8221;text&#8221; id=&#8221;getfirsttitlespicw&#8221; size=&#8221;3&#8243; value=&#8221;&lt;?=$public_r[spicwidth]?&gt;&#8221;&gt;<br />*高<br />&lt;input name=&#8221;getfirsttitlespich&#8221; type=&#8221;text&#8221; id=&#8221;getfirsttitlespich&#8221; size=&#8221;3&#8243; value=&#8221;&lt;?=$public_r[spicheight]?&gt;&#8221;&gt;<br />)&lt;/td&gt;<br />&lt;/tr&gt;<br />&lt;/table&gt;</p></blockquote><p>到这边，后台就可以使用kindeditor编辑器了：</p><p><img alt="20131220204632.png" src="/d/file/2014/06/17/fa8dd637881f844f667c46d21ec16a3d.png" width="863" height="380" /></p><p>但是这不代表就整合完成了，还要处理一下编辑器的分页符。</p><p>首先我们知道，kindeditor的分页符是<strong>pagebreak : &#8216;插入分页符&#8217;,</strong>  大概在kindeditor-all.js的6020处可以看到。</p><p>在kindeditor-all.js文件里搜索一下pagebreak，大概在9233处可以看到var pagebreakHtml = K.undef(self.pagebreakHtml, &#8216;&lt;hr style=&#8221;page-break-after: always;&#8221; /&gt;&#8217;);</p><p>那么要把&lt;hr style=&#8221;page-break-after: always;&#8221; /&gt;这一段改成帝国的分页符。</p><p>接下来再来kindeditor-4.1.10pluginspagebreak下找到pagebreak.js</p><p>我们可以看到var pagebreakHtml = K.undef(self.pagebreakHtml, &#8216;&lt;hr style=&#8221;page-break-after: always;&#8221; /&gt;&#8217;);</p><p>同样，把&lt;hr style=&#8221;page-break-after: always;&#8221; /&gt;这一段改成帝国的分页符。</p><p>到这里，分页符就搞定了。</p><p>接下来就是大头了，图片路径的设置。</p><p>找到kindeditor-4.1.10php目录下的file_manager_json.php和upload_json.php这两个文件。</p><p>把这两个文件的这段代码</p><blockquote><p>//根目录路径，可以指定绝对路径，比如 /var/www/attached/<br />$root_path = $php_path . &#8216;../attached/&#8217;;<br />//根目录URL，可以指定绝对路径，比如 http://www.yoursite.com/attached/<br />$root_url = $php_url . &#8216;../attached/&#8217;;</p><p>改成你想要的路径，记得，路径的目录一下要存在，比如我是改成这样的<br />//根目录路径，可以指定绝对路径，比如 /var/www/attached/<br />$root_path = $php_path . &#8216;../../d/file/&#8217;;<br />//根目录URL，可以指定绝对路径，比如 http://www.yoursite.com/attached/<br />$root_url = $php_url . &#8216;../../d/file/&#8217;;</p></blockquote><p>然后再在upload_json.php文件中的</p><blockquote><p>//检查扩展名<br />if (in_array($file_ext, $ext_arr[$dir_name]) === false) {<br />alert(&#8220;上传文件扩展名是不允许的扩展名。n只允许&#8221; . implode(&#8220;,&#8221;, $ext_arr[$dir_name]) . &#8220;格式。&#8221;);<br />}</p></blockquote><p>下面添加一下</p><p>$save_path = &#8216;../../d/file/&#8217;;</p><p>$save_url = &#8216;../../d/file/&#8217;;</p><p>最终如下：</p><blockquote><p>//检查扩展名<br />if (in_array($file_ext, $ext_arr[$dir_name]) === false) {<br />alert(&#8220;上传文件扩展名是不允许的扩展名。n只允许&#8221; . implode(&#8220;,&#8221;, $ext_arr[$dir_name]) . &#8220;格式。&#8221;);<br />}<br />$save_path = &#8216;../../d/file/&#8217;;<br />$save_url = &#8216;../../d/file/&#8217;;<br />//创建文件夹<br />if ($dir_name !== &#8221;) {<br />$save_path .= $dir_name . &#8220;/&#8221;;<br />$save_url .= $dir_name . &#8220;/&#8221;;<br />if (!file_exists($save_path)) {<br />mkdir($save_path);<br />}<br />}</p></blockquote><p>到这里，上传图片这一块就基本完成了。</p><p>但是有一点，这个编辑器的批量上传图片限制了一次只能传20个图片，并且每个图片不能超过1M。这个要怎么修改的，我也是胡乱改的，没想到被我给改对了。大致如下：</p><p>修改kindeditor-4.1.10pluginsmultiimage下的multiimage.js文件。</p><p>默认的是（大概在198行开始）：</p><blockquote><p>KindEditor.plugin(&#8216;multiimage&#8217;, function(K) {<br />var self = this, name = &#8216;multiimage&#8217;,<br />formatUploadUrl = K.undef(self.formatUploadUrl, true),<br />uploadJson = K.undef(self.uploadJson, self.basePath + &#8216;php/upload_json.php&#8217;),<br />imgPath = self.pluginsPath + &#8216;multiimage/images/&#8217;,<br />imageSizeLimit = K.undef(self.imageSizeLimit, &#8217;1MB&#8217;),<br />imageFileTypes = K.undef(self.imageFileTypes, &#8216;*.jpg;*.gif;*.png&#8217;),<br />imageUploadLimit = K.undef(self.imageUploadLimit, 20),<br />filePostName = K.undef(self.filePostName, &#8216;imgFile&#8217;),<br />lang = self.lang(name + &#8216;.&#8217;);</p></blockquote><p>眼尖的人一眼就看出了1M和20，这里改一下你所需要的，我是改成10M和200.<br />不知道到这里是不是就可以了，我是没测试。我还改了另外一个地方的代码，就是kindeditor-all.js文件下的一段和上面一样的代码，同样也改了10M和200。然后就可以了。<br />由于技术有限，现在还没搞定图片加水印的，如果有知晓的朋友，能否告知一下？</p>		</article>
      <div class="article-social"> <a href="javascript:;" class="action" data-pid="5429" data-event="like"><i class="glyphicon glyphicon-thumbs-up"></i>赞 (<span>0</span>)</a> <a href="#pinglun" class="action" data-event="login"><i class="glyphicon glyphicon-comment"></i>评论</a> <span class="action action-share bdsharebuttonbox"> <i class="glyphicon glyphicon-share"></i>分享 (<span class="bds_count" data-cmd="count"></span>)
        <div class="action-popover">
          <div class="popover top in">
            <div class="arrow"></div>
            <div class="popover-content"><a class="bds_qzone" data-cmd="qzone"></a><a class="bds_tsina" data-cmd="tsina"></a><a class="bds_weixin" data-cmd="weixin"></a><a class="bds_tqq" data-cmd="tqq"></a><a class="bds_sqq" data-cmd="sqq"></a><a class="bds_renren" data-cmd="renren"></a></div>
          </div>
        </div>
        </span> </div>
      <div class="article-tags"><div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></div>
      <div class="relates">
        <h3 class="title"><strong>相关阅读</strong></h3>
        <ul>
         
        </ul>
      </div>
      <h3 class="title" id="pinglun"></h3>
      <!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread" data-category="1" data-thread-key="99" 
	data-title="帝国CMS后台整合kindeditor编辑器" data-author-key="" data-url=""></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"henxue"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
<!--<script>
		  function CheckPl(obj)
		  {
		  if(obj.saytext.value=="")
		  {
		  alert("您没什么话要说吗？");
		  obj.saytext.focus();
		  return false;
		  }
		  return true;
		  }
		  </script><form action="/e/pl/doaction.php" method="post" name="saypl" id="saypl" onsubmit="return CheckPl(document.saypl)">
<table width="100%" border="0" cellpadding="0" cellspacing="0" id="plpost">

<tr>
<td><table width="100%" border="0" cellpadding="0" cellspacing="0" class="title">
<tr>
<td><strong>发表评论</strong></td>
<td align="right"><a href="/e/pl/?classid=1&amp;id=99">共有<span><script type="text/javascript" src="/e/public/ViewClick/?classid=1&id=99&down=2"></script></span>条评论</a></td>
</tr>
</table>
<table width="100%" border="0" cellspacing="10" cellpadding="0">
<tr>
<td><table width="100%" border="0" cellpadding="0" cellspacing="2">
<tr>
<td width="56%" align="left">用户名:
<input name="username" type="text" class="inputText" id="username" value="" size="16" /></td>
<td width="44%" align="left">密码:
<input name="password" type="password" class="inputText" id="password" value="" size="16" /></td>
</tr>
<tr>
<td align="left">验证码:
<input name="key" type="text" class="inputText" size="10" />
<img src="/e/ShowKey/?v=pl" align="absmiddle" /> </td>
<td align="left"><input name="nomember" type="checkbox" id="nomember" value="1" checked="checked" />
匿名发表</td>
</tr>
</table>
<textarea name="saytext" rows="6" id="saytext"></textarea><input name="imageField" type="image" src="/e/data/images/postpl.gif"/>
<input name="id" type="hidden" id="id" value="99" />
<input name="classid" type="hidden" id="classid" value="1" />
<input name="enews" type="hidden" id="enews" value="AddPl" />
<input name="repid" type="hidden" id="repid" value="0" />
<input type="hidden" name="ecmsfrom" value="/article/99.html"></td>
</tr>
</table>
</td>
</tr>
</table></form>-->
    </div>
  </div>
  <aside class="sidebar">
    <div class="widget widget_tags">
      <h3 class="title"><strong>热门标签</strong></h3>
      <ul class="widget_tags_inner">
<li><a title="点击查看所有关于站长的文章" href="/tags/../../tags/zhanzhang/">站长</a></li>
<li><a title="点击查看所有关于谷歌的文章" href="/tags/../../tags/google/">谷歌</a></li>
<li><a title="点击查看所有关于百度的文章" href="/tags/../../tags/baidu/">百度</a></li>
 	  
      </ul>
    </div>
    <div class="widget widget_searchbox">
      <h3 class="title"><strong>搜索文章</strong></h3>
<form accept-charset="utf-8" method="get" action="http://www.baidu.com/baidu" target="_blank" class="search-form">
<input type="text" name="word" class="form-control" placeholder="输入关键字" autofocus="" x-webkit-speech="">
<input type="submit" class="btn" value="搜索" name="submit">
        <input type="hidden" value="baidulocal" name="tn">
        <input type="hidden" value="3" name="cl">
        <input type="hidden" value="2097152" name="ct">
        <input type="hidden" value="henxue.net" name="si">
      </form>     
    </div>
    <script src="/d/js/acmsd/thea1.js"></script>
    <div class="widget widget_postlist">
      <h3 class="title"><strong>最新文章</strong></h3>
      <ul>
        
<li><a href="/article/66.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">结合项在列表页调用内容字段名称</span><span class="text-muted post-views">阅读(0)</span></a></li>
        
<li><a href="/article/69.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">帝国CMS动态页分页标签[!---show.listpage--]的一</span><span class="text-muted post-views">阅读(0)</span></a></li>
        
<li><a href="/article/68.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">灵动标签中用if判断第X条附加特殊样式</span><span class="text-muted post-views">阅读(0)</span></a></li>
        
<li><a href="/article/71.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">帝国CMS列表模板过滤简介的Html代码</span><span class="text-muted post-views">阅读(0)</span></a></li>
        
<li><a href="/article/70.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">帝国CMS修改列表页中当前分页的显示方式</span><span class="text-muted post-views">阅读(0)</span></a></li>
        
<li><a href="/article/73.html"><span class="thumbnail"><img data-original="" class="thumb"/></span><span class="text">帝国CMS中$navinfor和$GLOBALS的一些使用小技巧</span><span class="text-muted post-views">阅读(0)</span></a></li>
  	  
      </ul>
    </div>
  </aside>  
  <footer class="footer"> &copy; 2014 <a href="/">恨雪博客</a> &nbsp; 感谢 <a href="http://www.alibaixiu.com" target="_blank">阿里百秀</a> &nbsp; <a href="/sitemap.xml" target="_blank">网站地图</a> </footer>
  <div class="rollto"><a href="javascript:;"></a></div>
</section>
<script type='text/javascript' src='/skin/xiu/js/jquery.js?ver=1.0.1'></script> 
<script type='text/javascript' src='/skin/xiu/js/bootstrap.js?ver=1.0.1'></script> 
<script type='text/javascript' src='/skin/xiu/js/custom.js?ver=1.0.1'></script>
</body>
</html>